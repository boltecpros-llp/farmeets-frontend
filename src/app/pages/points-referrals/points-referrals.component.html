<div class="points-referrals-container p-3">
  <h3 class="mb-3">Points & Referrals</h3>
  <div class="card mb-3">
    <div class="card-body d-flex flex-column flex-md-row align-items-center justify-content-between">
      <div>
        <div class="fw-bold fs-5">Your Points</div>
        <div class="display-6">{{ points ?? 0 }}</div>
      </div>
      <div class="mt-3 mt-md-0">
        <div class="fw-bold fs-5">Referral Code</div>
        <div class="h4 mb-2">{{ referralCode }}</div>
        <div class="input-group">
          <input type="text" class="form-control" [value]="referralLink" readonly>
          <button class="btn btn-outline-secondary" (click)="copyReferralLink()"><i class="bi bi-clipboard"></i> Copy</button>
        </div>
      </div>
    </div>
  </div>
  <div class="d-flex justify-content-center mt-4">
    <div class="card" style="max-width: 320px;">
      <div class="card-body text-center">
        <div class="fw-bold mb-2">Share via QR Code</div>
        <canvas #qrCanvas width="180" height="180" class="mx-auto d-block border"></canvas>
        <div class="small text-muted mt-2">Scan to join with your referral</div>
      </div>
    </div>
  </div>

  <!-- Referrals Table -->
  <div class="w-100 mt-4">
    <h5 class="mb-3">Referrals <span *ngIf="referralsCount">({{ referralsCount }})</span> <span *ngIf="referralsPoints" class="badge bg-success ms-2">Points: {{ referralsPoints }}</span></h5>
    <div *ngIf="loading" class="text-center py-3">
      <div class="spinner-border text-success" role="status"></div>
      <div>Loading referrals...</div>
    </div>
    <div *ngIf="!loading && referrals.length > 0; else noReferrals">
      <div class="table-responsive">
        <table class="table table-bordered table-striped align-middle">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>Mobile</th>
              <th>Joined At</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let ref of referrals; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{ ref.firstName }} {{ ref.lastName }}</td>
              <td>{{ ref.mobile }}</td>
              <td>{{ ref.joinedAt | date:'medium' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <ng-template #noReferrals>
      <div class="text-center text-muted py-3">No referrals found.</div>
    </ng-template>
  </div>
</div>
